<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Chat</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="" />
  </head>
  <body>
    <div
      id="chat-log"
      style="border: 1px solid black; height: 300px; overflow-y: scroll"
    >
      <!-- Здесь будут отображаться сообщения -->
    </div>

    <input id="chat-message-input" type="text" size="100" />
    <button id="chat-message-submit">Send</button>

    <script>
      const roomName = "{{ room_name }}";
      const chatSocket = new WebSocket(
        "ws://127.0.0.1:8000/ws/chat/" + roomName + "/"
      );

      chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);
        const chatLog = document.querySelector("#chat-log");
        const newMessage = document.createElement("div");
        newMessage.textContent = data.message;
        chatLog.appendChild(newMessage);

        // Автопрокрутка вниз после нового сообщения
        chatLog.scrollTop = chatLog.scrollHeight;
      };

      document.querySelector("#chat-message-submit").onclick = function (e) {
        const messageInputDom = document.querySelector("#chat-message-input");
        const message = messageInputDom.value;
        chatSocket.send(
          JSON.stringify({
            message: message,
          })
        );
        messageInputDom.value = ""; // Очищаем поле после отправки
      };
    </script>
  </body>
</html>
